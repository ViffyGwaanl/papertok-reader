# RAG + Memoryï¼ˆPhase 1â€“5ï¼‰ä»»åŠ¡æ¸…å•ï¼ˆå«å½“å‰çŠ¶æ€ï¼‰

> æœ¬æ–‡ä¸ºå·¥ç¨‹ä»»åŠ¡æ¸…å•ï¼ˆå¯ç›´æ¥ç”¨äºéªŒæ”¶/æ¨è¿›ï¼‰ã€‚
> 
> Phase 3 è¯¦ç»†è®¾è®¡ä¸è¿›åº¦è¯´æ˜ï¼š`docs/ai/rag_phase3_library_rag_zh.md`

---

## Phase 1ï¼ˆå·²å®Œæˆï¼‰â€” RAG åŸºå»º

- [x] å»ºç«‹ `ai_index.db` çš„åŸºç¡€æ‰“å¼€/è¿ç§»/è·¯å¾„çº¦å®š
- [x] å»ºç«‹ç´¢å¼•å†™å…¥ä¸è¯»å–çš„åŸºç¡€ DAO/æœåŠ¡å±‚ï¼ˆå¯ä¾›å·¥å…·è°ƒç”¨ï¼‰
- [x] å·¥å…·æ³¨å†Œé“¾è·¯ä¸ request scope èƒ½åŠ›å¯¹é½ï¼ˆé¿å…ä¸èŠå¤© streaming ç›¸äº’ cancelï¼‰

äº¤ä»˜çŠ¶æ€ï¼šâœ… å·²åˆå…¥äº§å“ä»“åº“ `product/main`

---

## Phase 2ï¼ˆå·²å®Œæˆï¼‰â€” å•ä¹¦ RAGï¼ˆå½“å‰ä¹¦èŒƒå›´ï¼‰

- [x] æ”¯æŒå¯¹â€œå½“å‰ä¹¦â€æ„å»ºè¯­ä¹‰ç´¢å¼•ï¼ˆchunk + embedding å†™å…¥ `ai_index.db`ï¼‰
- [x] æä¾›å·¥å…·ï¼š`semantic_search_current_book`
- [x] evidence/jumpLink ä½¿ç”¨ `paperreader://reader/open?...`ï¼ˆä¸å†å»ºè®®ç”Ÿæˆ `anx://...`ï¼‰

äº¤ä»˜çŠ¶æ€ï¼šâœ… å·²åˆå…¥äº§å“ä»“åº“ `product/main`

---

## Phase 3ï¼ˆè¿›è¡Œä¸­ï¼‰â€” å…¨ä¹¦åº“ RAG + æ‰¹é‡ç´¢å¼•é˜Ÿåˆ—

### å·²å®Œæˆï¼ˆæˆªè‡³ 2026-02-25ï¼‰

- [x] `ai_index.db` v2ï¼šæ–°å¢ `ai_index_jobs`ï¼ˆé˜Ÿåˆ—æŒä¹…åŒ–è¡¨ï¼‰+ æ‰©å±• `ai_book_index`ï¼ˆçŠ¶æ€/é‡è¯•/ç‰ˆæœ¬å­—æ®µï¼‰
- [x] Headless Reader Bridgeï¼šä¸æ‰“å¼€é˜…è¯»é¡µä¹Ÿèƒ½ä¸ºä»»æ„ `bookId` æ‹‰å– TOC/ç« èŠ‚æ–‡æœ¬
- [x] Library index queueï¼šrunnerï¼ˆé‡è¯•/é‡å¯å½’ä¸€åŒ–/å•æµ‹ï¼‰+ Riverpod serviceï¼ˆpause/resume/cancel/clear finished + èŠ‚æµåˆ·æ–°ï¼‰
- [x] Settings é¡¶å±‚å…¥å£ï¼š**AI ç´¢å¼•ï¼ˆä¹¦åº“ï¼‰**ï¼ˆæ”¯æŒæ‰‹åŠ¨å¤šé€‰å…¥é˜Ÿ + é˜Ÿåˆ—æ§åˆ¶ï¼‰
- [x] Reader jump linkï¼šç»Ÿä¸€ä¸º `paperreader://reader/open?...`

### å¾…å®Œæˆï¼ˆPhase 3 å‰©ä½™æˆå“é¡¹ï¼‰

- [ ] ä¹¦ç±åˆ—è¡¨ç­›é€‰ä¸ç´¢å¼•çŠ¶æ€è”åŠ¨ï¼ˆDB çœŸå€¼é©±åŠ¨ï¼‰ï¼š
  - [ ] æœªç´¢å¼• / è¿‡æœŸ / å·²ç´¢å¼• çš„ç­›é€‰å¿…é¡»æ¥è‡ªç´¢å¼•åº“å…ƒä¿¡æ¯ï¼Œè€Œéä»… UI çŠ¶æ€
  - [ ] åˆ—è¡¨å±•ç¤ºä¸ç´¢å¼•é˜Ÿåˆ—çŠ¶æ€ï¼ˆqueued/running/failed/succeededï¼‰ä¸€è‡´ä¸”å¯è§£é‡Š
- [ ] `semantic_search_library`ï¼šå…¨åº“æ£€ç´¢å·¥å…· + æ£€ç´¢ç®¡çº¿ï¼ˆHybridï¼šFTS/BM25 + vector + MMR å»é‡ï¼‰
- [ ] å¼•ç”¨/evidence è·¨ä¹¦è·³è½¬ä½“éªŒæ‰“ç£¨ï¼š
  - [ ] è·³è½¬ä½ç½® best-effortï¼ˆhref/cfi/page/anchorï¼‰è¦†ç›–ä¸»è¦æ ¼å¼
  - [ ] å¯¹ç¼ºå¤±å®šä½ä¿¡æ¯çš„ fallback è¡Œä¸ºå¯é¢„æœŸï¼ˆä¾‹å¦‚ç« èŠ‚å¼€å¤´ï¼‰
- [ ] QA checklist + å›å½’ï¼ˆå»ºè®®è‡³å°‘åŒ…å«ï¼‰ï¼š
  - [ ] é˜Ÿåˆ—æš‚åœ/æ¢å¤/å–æ¶ˆ/clear finished åœ¨è¾¹ç•ŒçŠ¶æ€ä¸‹è¡Œä¸ºæ­£ç¡®
  - [ ] å´©æºƒ/é‡å¯ï¼šrunningâ†’queued å½’ä¸€åŒ–ä¸ç»­è·‘æ­£ç¡®
  - [ ] å¤§ä¹¦/å¤šä¹¦ç´¢å¼•æ—¶çš„å‰å°å¡é¡¿ã€å†…å­˜ã€è€—ç”µå¯æ¥å—
  - [ ] ç½‘ç»œå¤±è´¥/é™æµï¼šé‡è¯•ä¸é”™è¯¯æç¤ºå¯ç†è§£
- [ ] åˆå…¥ `product/main`ï¼ˆå®Œæˆä¸Šè¿°éªŒæ”¶åï¼‰

äº¤ä»˜çŠ¶æ€ï¼šğŸš§ è¿›è¡Œä¸­ï¼ˆç›®æ ‡åˆ†æ”¯ï¼š`product/feat/rag-phase3-library-rag` â†’ `product/main`ï¼‰

---

## Phase 4ï¼ˆå·²å®Œæˆï¼‰â€” Memoryï¼ˆæœ¬åœ° Markdownï¼‰

- [x] æœ¬åœ° memory storeï¼š`<documents>/memory/`ï¼ˆ`MEMORY.md` + `YYYY-MM-DD.md`ï¼‰
- [x] Toolsï¼š`memory_read` / `memory_search` / `memory_append` / `memory_replace`
- [x] Memory è®¾ç½®é¡µ/ç¼–è¾‘é¡µ

äº¤ä»˜çŠ¶æ€ï¼šâœ… å·²åˆå…¥äº§å“ä»“åº“ `product/main`

---

## Phase 5ï¼ˆå·²å®Œæˆï¼‰â€” å¤‡ä»½/æ¢å¤å¢å¼ºï¼ˆå¯é€‰åŒ…å«ç´¢å¼•/è®°å¿†ï¼‰

- [x] v5 backup manifest flagsï¼š`containsMemory` / `containsAiIndexDb`
- [x] å¯¼å‡ºï¼šå¯é€‰åŒ…å« `memory/`
- [x] å¯¼å‡ºï¼šå¯é€‰åŒ…å« `databases/ai_index.db`ï¼ˆå« `-wal/-shm`ï¼‰ï¼Œé»˜è®¤å…³é—­
- [x] å¯¼å…¥ï¼šå¯é€‰æ¢å¤ memory ä¸ç´¢å¼•ï¼›æœªé€‰æ‹©æ¢å¤æ—¶ä¿ç•™æœ¬åœ°å¯¹åº”æ•°æ®
- [x] å¯¼å…¥å…·å¤‡å›æ»šä¿æŠ¤ï¼ˆ`.bak.<timestamp>`ï¼‰

äº¤ä»˜çŠ¶æ€ï¼šâœ… å·²åˆå…¥äº§å“ä»“åº“ `product/main`
