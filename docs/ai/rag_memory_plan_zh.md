# RAG + Memoryï¼ˆPhase 1â€“5ï¼‰æ€»ä½“è®¡åˆ’ä¸å½“å‰çŠ¶æ€ï¼ˆå·¥ç¨‹å£å¾„ï¼‰

> é€‚ç”¨ä»“åº“ï¼š**Paper Readerï¼ˆpapertok-readerï¼‰äº§å“ä»“åº“**ã€‚
> 
> æœ¬æ–‡ç”¨äºå¯¹é½â€œRAGï¼ˆæ£€ç´¢å¢å¼ºï¼‰+ Memoryï¼ˆæœ¬åœ°è®°å¿†ï¼‰â€è¿™æ¡çº¿çš„ **åˆ†é˜¶æ®µäº¤ä»˜è¾¹ç•Œã€ä¾èµ–å…³ç³»ä¸éªŒæ”¶å£å¾„**ã€‚
>
> è¯´æ˜ï¼šPhase 3 çš„è®¾è®¡ç»†èŠ‚ä¸å®ç°è¿›åº¦åœ¨ç‹¬ç«‹æ–‡æ¡£ç»´æŠ¤ï¼š
> - `docs/ai/rag_phase3_library_rag_zh.md`

---

## 0. æ€»ä½“ç›®æ ‡ä¸è¾¹ç•Œ

### 0.1 ç›®æ ‡

- **Phase 1â€“2ï¼š** å…ˆæŠŠâ€œå½“å‰ä¹¦èŒƒå›´â€çš„ RAG è·‘é€šï¼ˆå¯ç´¢å¼•ã€å¯æ£€ç´¢ã€å¯å¼•ç”¨è·³è½¬ï¼‰ã€‚
- **Phase 3ï¼š** å°† RAG æ‰©å±•åˆ°â€œå…¨ä¹¦åº“â€ï¼Œå¼•å…¥ **å¯æ¢å¤/å¯å¹¶å‘/å¯å–æ¶ˆ** çš„æ‰¹é‡ç´¢å¼•é˜Ÿåˆ—ï¼Œå¹¶æä¾›äº§å“çº§å…¥å£ï¼ˆAI ç´¢å¼•ï¼ˆä¹¦åº“ï¼‰ï¼‰ã€‚
- **Phase 4ï¼š** å¢åŠ æœ¬åœ° **Markdown Memory**ï¼ˆMEMORY.md + æ—¥è®°ï¼‰ä¸é…å¥—å·¥å…·/è®¾ç½®é¡µã€‚
- **Phase 5ï¼š** å¤‡ä»½/æ¢å¤å¢å¼ºï¼šåœ¨ v5 æ‰‹åŠ¨å¤‡ä»½ ZIP ä¸­ï¼Œæ”¯æŒ **å¯é€‰åŒ…å«** `memory/` ä¸ `ai_index.db`ï¼ˆä»¥åŠ `-wal/-shm`ï¼‰ï¼Œå¹¶ä¿æŒâ€œé»˜è®¤ä¸å¸¦æ•æ„Ÿ/å¤§ä½“ç§¯å†…å®¹â€çš„åŸåˆ™ã€‚

### 0.2 å…³é”®çº¦æŸï¼ˆæŒç»­æœ‰æ•ˆï¼‰

- **éšç§ä¼˜å…ˆï¼š** é»˜è®¤ä¸æŠŠå‘é‡ç´¢å¼•çº³å…¥åŒæ­¥ï¼›æ‰‹åŠ¨å¤‡ä»½ä¹Ÿé»˜è®¤ä¸åŒ…å« `ai_index.db`ã€‚
- **ç§»åŠ¨ç«¯èµ„æºçº¦æŸï¼š** ç´¢å¼•ä»»åŠ¡å¿…é¡»èŠ‚æµï¼ˆå¹¶å‘/æš‚åœ/å–æ¶ˆ/é‡è¯•ï¼‰ï¼Œé¿å…â€œé•¿æ—¶é—´å ç”¨å‰å°/ç”µé‡â€å¯¼è‡´ä½“éªŒå´©ã€‚
- **è·³è½¬é“¾æ¥è§„èŒƒï¼š** Reader è·³è½¬ deep link ä»¥ `paperreader://reader/open?...` ä¸ºå‡†ï¼›`anx://...` ä¸º legacyï¼ˆæ–‡æ¡£ä¸­ä¸å†å»ºè®®ç”Ÿæˆï¼‰ã€‚

---

## 1. Phase åˆ’åˆ†ï¼ˆäº¤ä»˜ç‰© + çŠ¶æ€ï¼‰

> çŠ¶æ€å£å¾„ï¼šä»¥äº§å“ä»“åº“ `main` æ˜¯å¦å·²åˆå…¥ä¸ºå‡†ã€‚

| Phase | ä¸»é¢˜ | å…³é”®äº¤ä»˜ç‰©ï¼ˆæ‘˜è¦ï¼‰ | çŠ¶æ€ |
|---|---|---|---|
| 1 | RAG åŸºå»ºä¸ç´¢å¼•è½åº“ï¼ˆåŸºç¡€å½¢æ€ï¼‰ | `ai_index.db` åŸºç¡€ schema / ç´¢å¼•å†™å…¥è·¯å¾„ / å·¥å…·æ³¨å†Œä¸è°ƒç”¨é“¾è·¯ | âœ… å·²å®Œæˆï¼ˆå·²åˆå…¥ `product/main`ï¼‰ |
| 2 | å•ä¹¦ RAGï¼ˆå½“å‰ä¹¦èŒƒå›´ï¼‰ | `semantic_search_current_book`ï¼ˆæˆ–ç­‰ä»·èƒ½åŠ›ï¼‰ï¼›ç´¢å¼•æ„å»ºå…¥å£ï¼›å¼•ç”¨ç‰‡æ®µä¸è·³è½¬é“¾æ¥ï¼ˆ`paperreader://`ï¼‰ | âœ… å·²å®Œæˆï¼ˆå·²åˆå…¥ `product/main`ï¼‰ |
| 3 | å…¨ä¹¦åº“ RAG + æ‰¹é‡ç´¢å¼•é˜Ÿåˆ— | `ai_index.db` æ‰©å±•ï¼ˆjobs/çŠ¶æ€ï¼‰ï¼›Headless Reader Bridgeï¼›â€œAI ç´¢å¼•ï¼ˆä¹¦åº“ï¼‰â€å…¥å£ï¼›å…¨åº“æ£€ç´¢å·¥å…· `semantic_search_library` | ğŸš§ è¿›è¡Œä¸­ï¼ˆ`product/feat/rag-phase3-library-rag`ï¼‰ |
| 4 | Memoryï¼ˆæœ¬åœ° Markdown è®°å¿†ï¼‰ | `<documents>/memory/`ï¼ˆMEMORY.md + daily notesï¼‰ï¼›memory_* toolsï¼›Memory è®¾ç½®/ç¼–è¾‘é¡µ | âœ… å·²å®Œæˆï¼ˆå·²åˆå…¥ `product/main`ï¼‰ |
| 5 | å¤‡ä»½/æ¢å¤å¢å¼ºï¼ˆå¯é€‰åŒ…å«ç´¢å¼•/è®°å¿†ï¼‰ | v5 backupï¼šmanifest flagsï¼›å¯é€‰åŒ…å« `memory/` ä¸ `databases/ai_index.db(+wal/shm)`ï¼›å¯¼å…¥å›æ»šä¸â€œå¯é€‰æ¢å¤â€ | âœ… å·²å®Œæˆï¼ˆå·²åˆå…¥ `product/main`ï¼‰ |

---

## 2. Phase 3ï¼ˆå½“å‰è¿›è¡Œä¸­ï¼‰éªŒæ”¶è¾¹ç•Œï¼ˆæˆå“å£å¾„ï¼‰

Phase 3 çš„â€œæˆå“â€å®šä¹‰ä¸ºï¼šç”¨æˆ·èƒ½åœ¨ **Settings â†’ AI â†’ AI ç´¢å¼•ï¼ˆä¹¦åº“ï¼‰** çœ‹åˆ°é˜Ÿåˆ—ä¸ç´¢å¼•çŠ¶æ€ï¼Œå¹¶åœ¨ AI å¯¹è¯ä¸­é€‰æ‹©/è§¦å‘ **å…¨ä¹¦åº“æ£€ç´¢**ï¼Œä¸”å¼•ç”¨æ¥æºå¯ç‚¹å‡»è·³è½¬åˆ°å¯¹åº”ä¹¦ç±ä½ç½®ã€‚

### 2.1 å·²å®Œæˆçš„ Phase 3 å­äº¤ä»˜ï¼ˆæ‘˜è¦ï¼‰

ä»¥ `docs/ai/rag_phase3_library_rag_zh.md` çš„â€œå®ç°è¿›åº¦â€ç« èŠ‚ä¸ºå‡†ï¼Œå½“å‰å·²å…·å¤‡ï¼š

- `ai_index.db` v2 è¿ç§»ï¼ˆé˜Ÿåˆ—è¡¨ `ai_index_jobs` + ç´¢å¼•å…ƒä¿¡æ¯æ‰©å±•ï¼‰ã€‚
- Headless Reader Bridgeï¼ˆæ— éœ€æ‰“å¼€é˜…è¯»é¡µå³å¯æŠ½å–ä»»æ„ `bookId` çš„ TOC/ç« èŠ‚æ–‡æœ¬ï¼‰ã€‚
- Library index queueï¼ˆrunner + serviceï¼‰ï¼špause/resume/cancel/clear finishedï¼Œå«é‡å¯å½’ä¸€åŒ–ä¸å•æµ‹ã€‚
- Settings é¡¶å±‚å…¥å£ï¼š**AI ç´¢å¼•ï¼ˆä¹¦åº“ï¼‰**ï¼ˆæ”¯æŒå¤šé€‰å…¥é˜Ÿä¸é˜Ÿåˆ—æ§åˆ¶ï¼‰ã€‚
- Reader jump linkï¼šå·²åˆ‡æ¢ä¸º `paperreader://reader/open?...`ã€‚

### 2.2 Phase 3 å‰©ä½™é¡¹ï¼ˆå¿…é¡»å®Œæˆæ‰èƒ½åˆå…¥ mainï¼‰

- **`semantic_search_library`**ï¼šå…¨åº“æ£€ç´¢å·¥å…·ä¸æ£€ç´¢ç®¡çº¿ï¼ˆHybridï¼šFTS/BM25 + vector + MMR å»é‡ï¼‰ã€‚
- **ç´¢å¼•çŠ¶æ€çœŸå€¼è”åŠ¨ï¼š** ä¹¦ç±åˆ—è¡¨ç­›é€‰ï¼ˆæœªç´¢å¼•/è¿‡æœŸ/å·²ç´¢å¼•ï¼‰å¿…é¡»ç”± DB çœŸå€¼é©±åŠ¨ï¼ˆä¸æ˜¯ä»… UI chipï¼‰ã€‚
- **QA + checklistï¼š** å¼•ç”¨/evidence çš„è·¨ä¹¦è·³è½¬ä½“éªŒæ‰“ç£¨ã€å¤±è´¥æ¢å¤ã€é˜Ÿåˆ—è¾¹ç•Œæ¡ä»¶éªŒè¯ã€‚
- **åˆå…¥ `product/main`ï¼š** å®Œæˆå›å½’ååˆå¹¶å¹¶åœ¨ `main` çœŸæœºéªŒæ”¶ã€‚

---

## 3. å…³è”æ–‡æ¡£

- Phase 3 è®¾è®¡/è¿›åº¦ï¼š`docs/ai/rag_phase3_library_rag_zh.md`
- ä»»åŠ¡æ¸…å•ï¼ˆPhase 1â€“5ï¼‰ï¼š`docs/ai/rag_memory_tasks_zh.md`
- æ‰‹åŠ¨å¤‡ä»½/æ¢å¤ï¼ˆå« memory/ ä¸ ai_index.db å¯é€‰åŒ…å«ï¼‰ï¼š`docs/ai/backup_restore_icloud.md`
